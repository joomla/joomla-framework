language: php

php:
  - 5.3
  - 5.4
  - hhvm

# Establishes a matrix and allows the hhvm build to fail without impacting success
matrix:
  fast_finish: true
  allow_failures:
    - php: hhvm

before_install:
  - composer self-update
  - sudo -E -s build/travis/scripts/before-install.sh
  - sudo -E -s build/travis/scripts/apache2-vhost.sh
  - sudo -E -s build/travis/scripts/apache2-configure.sh


install:
  - sudo -E -s build/travis/scripts/install.sh

before_script:
  - composer update --dev
  - sudo -E -s build/travis/scripts/before-script.sh
  - phpenv rehash
  # dump some environmental info
  - phpunit --version
  - php -v
  # Setup Databases
  - mysql -e 'create database joomla_ut;'
  - mysql joomla_ut < src/Joomla/Database/Tests/Stubs/mysql.sql
  - psql -c 'create database joomla_ut;' -U postgres
  - psql -d joomla_ut -a -f src/Joomla/Database/Tests/Stubs/postgresql.sql

script:
  - ant composervalidate
  - ant travis-phpcs
  - vendor/bin/phpunit --configuration phpunit.travis.xml
